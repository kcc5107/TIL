# TIL: 일정 관리 앱 프로젝트 트러블슈팅

### 여러 조건에 맞는 일정 목록들을 조회하는 API 구현

## 문제 상황

작성자명, 수정일 두 가지의 조건을 둘 다 충족하거나 하나만 충족하거나 둘 다 충족하지 않는 네 가지의 경우의 수가 존재한다.  
이를 한 개의 메서드에서 조건에 따라 동적으로 처리하기 위해 sql쿼리문을 `StringBuilder`를 사용해 동적으로 구성해보았는데,  
결국 조건에 따라 인자 개수가 달라지면서 어려움을 겪었다.

## 해결 과정

### 1. if조건 분기로 가변 인자 넘기기

`if`조건 분기로 나누는 것을 고려해보았을 때, 로직을 `Service layer`에서 조건 분기로 나누어서  
`Repository layer`의 매개 변수가 다른 똑같은 이름의 오버로딩된 메서드 4개를 호출하는 것을 생각해보았다.  
하지만 이 방법은 조건이 늘어나면 메서드도 배로 늘어날 수 있기때문에 유지보수성과 확장성이 매우 좋지 않고 비효율적으로 느껴졌다.

---


### **2. `List<Object>`와 toArray() 사용** 

`JdbcTemplate.query()`의 형식은 `JdbcTemplate.query(String sql, Object[] args, RowMapper<T> rowMapper)`으로  
sql쿼리의 ? 개수와 `args.length`가 정확히 일치해야 한다.  
조건에 따라 동적으로 인자 수가 달라지므로 `List<Object>`에 인자 값들을 담고 `toArray()`로 넘기는게 안정적이고 표준적인 방식이다.

```java
List<Object> params = new ArrayList<>();
params.add(...);
params.add(...);

jdbcTemplate.query(sb.toString, rowMapper, params.toArray(),);
```

---

## 회고

일정 조회 API 구현에서 가장 까다로웠던 부분은 조건에 따라 sql 쿼리와 인자의 개수가 달라진다는 점이었다.  
처음에는 `StringBuilder`를 사용해서 문자열을 이어붙여서 쿼리문을 동적으로 구성하면 쉬울거라고 생각했지만, 생각과 달리 시행착오를 많이 겪었다.  
결국 `List<Object>`와 `toArray()`를 활용해 쿼리 파라미터를 유동적으로 구성하여 해결하였는데,  
이 방법을 사용한다면 다음에도 여러 조건을 처리할 때 유용하게 사용 할 수 있을 것 같다.  
이외에도 이번 프로젝트를 진행하면서 익숙하지 않은 Spring 사용으로 인해 **컴파일 오류가 뜨지 않는 오타**나 **설정 문제**때문에 시간을 많이 잡아먹었는데  
다음에는 더 잘 할수 있는 계기가 될 것이라고 생각한다.